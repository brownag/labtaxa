<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Get 'Lab Data Mart' 'SQLite' Snapshot — get_LDM_snapshot • labtaxa</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get 'Lab Data Mart' 'SQLite' Snapshot — get_LDM_snapshot"><meta name="description" content="Downloads the USDA-NRCS Kellogg Soil Survey Laboratory (KSSL) 'Lab Data Mart'
database snapshot from the official download portal. Uses RSelenium for
automated browser control to navigate the webpage and initiate the download,
which is cached in the user's local data directory for fast subsequent access.
Returns the official USDA-NRCS Kellogg Soil Survey Laboratory
'Lab Data Mart' download page URL.
Returns the directory where labtaxa caches downloaded data and
processed results. Creates the directory if it doesn't exist."><meta property="og:description" content="Downloads the USDA-NRCS Kellogg Soil Survey Laboratory (KSSL) 'Lab Data Mart'
database snapshot from the official download portal. Uses RSelenium for
automated browser control to navigate the webpage and initiate the download,
which is cached in the user's local data directory for fast subsequent access.
Returns the official USDA-NRCS Kellogg Soil Survey Laboratory
'Lab Data Mart' download page URL.
Returns the directory where labtaxa caches downloaded data and
processed results. Creates the directory if it doesn't exist."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">labtaxa</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/brownag/labtaxa" aria-label="GitHub"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Get 'Lab Data Mart' 'SQLite' Snapshot</h1>
      <small class="dont-index">Source: <a href="https://github.com/brownag/labtaxa/blob/main/R/snapshot.R" class="external-link"><code>R/snapshot.R</code></a></small>
      <div class="d-none name"><code>get_LDM_snapshot.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Downloads the USDA-NRCS Kellogg Soil Survey Laboratory (KSSL) 'Lab Data Mart'
database snapshot from the official download portal. Uses <code>RSelenium</code> for
automated browser control to navigate the webpage and initiate the download,
which is cached in the user's local data directory for fast subsequent access.</p>
<p>Returns the official USDA-NRCS Kellogg Soil Survey Laboratory
'Lab Data Mart' download page URL.</p>
<p>Returns the directory where labtaxa caches downloaded data and
processed results. Creates the directory if it doesn't exist.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get_LDM_snapshot</span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  cache <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  keep_zip <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  dlname <span class="op">=</span> <span class="st">"ncss_labdatagpkg.zip"</span>,</span>
<span>  dbname <span class="op">=</span> <span class="st">"ncss_labdata.gpkg"</span>,</span>
<span>  cachename <span class="op">=</span> <span class="st">"cached-LDM-SPC.rds"</span>,</span>
<span>  companiondlname <span class="op">=</span> <span class="st">"ncss_morphologic.zip"</span>,</span>
<span>  companiondbname <span class="op">=</span> <span class="st">"ncss_morphologic.sqlite"</span>,</span>
<span>  companioncachename <span class="op">=</span> <span class="st">"cached-morph-SPC.rds"</span>,</span>
<span>  dirname <span class="op">=</span> <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/userdir.html" class="external-link">R_user_dir</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"labtaxa"</span><span class="op">)</span>,</span>
<span>  default_dir <span class="op">=</span> <span class="st">"~/Downloads"</span>,</span>
<span>  port <span class="op">=</span> <span class="fl">4567L</span>,</span>
<span>  timeout <span class="op">=</span> <span class="fl">1e+05</span>,</span>
<span>  baseurl <span class="op">=</span> <span class="fu">ldm_db_download_url</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ldm_db_download_url</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ldm_data_dir</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed to <code><a href="http://ncss-tech.github.io/soilDB/reference/fetchLDM.html" class="external-link">soilDB::fetchLDM()</a></code> for controlling data retrieval</p></dd>


<dt id="arg-cache">cache<a class="anchor" aria-label="anchor" href="#arg-cache"></a></dt>
<dd><p>Default: <code>TRUE</code>; cache the downloaded data as an RDS file and reuse
on subsequent calls? When <code>FALSE</code>, forces fresh download and processing.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Default: <code>TRUE</code>; print informative progress messages about download,
processing, and caching operations? Set to <code>FALSE</code> for silent operation.</p></dd>


<dt id="arg-keep-zip">keep_zip<a class="anchor" aria-label="anchor" href="#arg-keep-zip"></a></dt>
<dd><p>Default: <code>FALSE</code>; retain the downloaded ZIP archive files after
extraction? Set to <code>TRUE</code> to preserve raw downloads for manual inspection.</p></dd>


<dt id="arg-dlname">dlname<a class="anchor" aria-label="anchor" href="#arg-dlname"></a></dt>
<dd><p>Default: <code>"ncss_labdatagpkg.zip"</code>; file name for the main LDM database download</p></dd>


<dt id="arg-dbname">dbname<a class="anchor" aria-label="anchor" href="#arg-dbname"></a></dt>
<dd><p>Default: <code>"ncss_labdata.gpkg"</code>; file name for the extracted GeoPackage database</p></dd>


<dt id="arg-cachename">cachename<a class="anchor" aria-label="anchor" href="#arg-cachename"></a></dt>
<dd><p>Default: <code>"cached-LDM-SPC.rds"</code>; file name for the cached LDM <code>SoilProfileCollection</code></p></dd>


<dt id="arg-companiondlname">companiondlname<a class="anchor" aria-label="anchor" href="#arg-companiondlname"></a></dt>
<dd><p>Default: <code>"ncss_morphologic.zip"</code>; file name for morphologic data download</p></dd>


<dt id="arg-companiondbname">companiondbname<a class="anchor" aria-label="anchor" href="#arg-companiondbname"></a></dt>
<dd><p>Default: <code>"ncss_morphologic.sqlite"</code>; file name for extracted morphologic database</p></dd>


<dt id="arg-companioncachename">companioncachename<a class="anchor" aria-label="anchor" href="#arg-companioncachename"></a></dt>
<dd><p>Default: <code>"cached-morph-SPC.rds"</code>; file name for cached morphologic <code>SoilProfileCollection</code></p></dd>


<dt id="arg-dirname">dirname<a class="anchor" aria-label="anchor" href="#arg-dirname"></a></dt>
<dd><p>Data cache directory for the labtaxa package. Default: <code>tools::R_user_dir(package = "labtaxa")</code>.
This directory is created automatically if it doesn't exist.</p></dd>


<dt id="arg-default-dir">default_dir<a class="anchor" aria-label="anchor" href="#arg-default-dir"></a></dt>
<dd><p>Default directory where RSelenium Firefox downloads files before moving to cache.
Default: <code>"~/Downloads"</code>. Useful if your default browser download location differs.</p></dd>


<dt id="arg-port">port<a class="anchor" aria-label="anchor" href="#arg-port"></a></dt>
<dd><p>Default: <code>4567L</code>; port number for Selenium WebDriver. Change if port is already in use.</p></dd>


<dt id="arg-timeout">timeout<a class="anchor" aria-label="anchor" href="#arg-timeout"></a></dt>
<dd><p>Default: <code>1e5</code> seconds (~27.8 hours); maximum time to wait for file download</p></dd>


<dt id="arg-baseurl">baseurl<a class="anchor" aria-label="anchor" href="#arg-baseurl"></a></dt>
<dd><p>Default: <code>"https://ncsslabdatamart.sc.egov.usda.gov/database_download.aspx"</code>;
URL of the KSSL Lab Data Mart download page</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>SoilProfileCollection</code> object (from the <code>aqp</code> package) containing
laboratory-analyzed soil profile data. The object has two components:</p><ul><li><p><code>site</code> data: Profile-level attributes (e.g., soil taxonomy, coordinates)</p></li>
<li><p><code>horizons</code> data: Horizon-level laboratory analyses (e.g., pH, texture, nutrients)
Use <code>length(x)</code> to get the number of profiles, <code>site(x)</code> for site data,
and <code>horizons(x)</code> for horizon (layer) data.</p></li>
</ul><p>Character string containing the URL</p>
<p>Character string containing the absolute path to the cache directory</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Laboratory pedon (soil profile) data are retrieved from the downloaded GeoPackage
SQLite database using <code><a href="http://ncss-tech.github.io/soilDB/reference/fetchLDM.html" class="external-link">soilDB::fetchLDM()</a></code> and cached as an RDS file containing
a <code>SoilProfileCollection</code> object. Companion morphologic (field description) data
are retrieved using <code><a href="http://ncss-tech.github.io/soilDB/reference/fetchNASIS.html" class="external-link">soilDB::fetchNASIS()</a></code> and cached separately.</p>
<p>This is the official USDA-NRCS webpage from which KSSL database
snapshots are downloaded. The page uses JavaScript and requires
browser automation via RSelenium to access.</p>
<p>The cache directory is located at:</p><ul><li><p>Linux/Mac: <code>~/.local/share/R/labtaxa</code></p></li>
<li><p>Windows: <code>C:\Users\USERNAME\AppData\Local\R\labtaxa</code></p></li>
</ul><p>This follows the XDG Base Directory specification via <code><a href="https://rdrr.io/r/tools/userdir.html" class="external-link">tools::R_user_dir()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="caching-behavior">Caching Behavior<a class="anchor" aria-label="anchor" href="#caching-behavior"></a></h2>


<p>By default (<code>cache = TRUE</code>), results are automatically cached as RDS files in
<code>tools::R_user_dir(package="labtaxa")</code>. Subsequent calls to <code>get_LDM_snapshot()</code>
with <code>cache = TRUE</code> will load the cached data without re-downloading or
re-processing. Use <code>cache = FALSE</code> to force a fresh download and rebuild.</p>
    </div>
    <div class="section level2">
    <h2 id="data-versions">Data Versions<a class="anchor" aria-label="anchor" href="#data-versions"></a></h2>


<p>KSSL data is versioned by month. Always check the Docker image or metadata
file to determine which data version you're working with. For reproducible
research, pin to specific Docker image tags: <code>ghcr.io/brownag/labtaxa:2026.02</code></p>
    </div>
    <div class="section level2">
    <h2 id="performance-notes">Performance Notes<a class="anchor" aria-label="anchor" href="#performance-notes"></a></h2>


<p>The full KSSL database contains ~65,000 soil profiles with 500,000+ horizons.
Initial download and processing typically takes 10-30 minutes depending on
internet speed. Subsequent calls using cached data complete in &lt;1 second.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index">
<ul><li><p><code><a href="cache_labtaxa.html">load_labtaxa()</a></code> to load previously cached data (much faster)</p></li>
<li><p><code><a href="cache_labtaxa.html">load_labmorph()</a></code> to load morphologic data from cache</p></li>
<li><p><code><a href="cache_labtaxa.html">cache_labtaxa()</a></code> to manually save results to cache</p></li>
<li><p><code>ldm_data_dir()</code> to find the data cache directory</p></li>
<li><p><code><a href="http://ncss-tech.github.io/soilDB/reference/fetchLDM.html" class="external-link">soilDB::fetchLDM()</a></code> for lower-level database access</p></li>
<li><p><code><a href="https://ncss-tech.github.io/aqp/reference/SoilProfileCollection-class.html" class="external-link">aqp::SoilProfileCollection</a></code> for manipulating profile data</p></li>
</ul><ul><li><p><code>get_LDM_snapshot()</code> which downloads data to this directory</p></li>
<li><p><code><a href="cache_labtaxa.html">load_labtaxa()</a></code> which loads cached data from this directory</p></li>
<li><p><code><a href="cache_labtaxa.html">cache_labtaxa()</a></code> to manually save data to this directory</p></li>
</ul></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Download and cache KSSL data (typically takes 10-30 minutes on first run)</span></span></span>
<span class="r-in"><span><span class="va">ldm</span> <span class="op">&lt;-</span> <span class="fu">get_LDM_snapshot</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check what you downloaded</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ldm</span><span class="op">)</span>  <span class="co"># Number of profiles</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">site</span><span class="op">(</span><span class="va">ldm</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Site-level attributes</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Subsequent calls are fast (load from cache)</span></span></span>
<span class="r-in"><span><span class="va">ldm</span> <span class="op">&lt;-</span> <span class="fu">get_LDM_snapshot</span><span class="op">(</span><span class="op">)</span>  <span class="co"># &lt;1 second!</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Access profile data</span></span></span>
<span class="r-in"><span><span class="va">profiles</span> <span class="op">&lt;-</span> <span class="fu">site</span><span class="op">(</span><span class="va">ldm</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">horizons</span> <span class="op">&lt;-</span> <span class="fu">horizons</span><span class="op">(</span><span class="va">ldm</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Subset to specific soil orders</span></span></span>
<span class="r-in"><span><span class="va">mollisols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ldm</span>, <span class="va">SSL_taxorder</span> <span class="op">==</span> <span class="st">"mollisols"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Found %d mollisols\\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mollisols</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Force fresh download (skip cache)</span></span></span>
<span class="r-in"><span><span class="va">ldm_fresh</span> <span class="op">&lt;-</span> <span class="fu">get_LDM_snapshot</span><span class="op">(</span>cache <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use with soilDB for custom database queries</span></span></span>
<span class="r-in"><span><span class="va">ldm</span> <span class="op">&lt;-</span> <span class="fu">get_LDM_snapshot</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">horizons_data</span> <span class="op">&lt;-</span> <span class="fu">horizons</span><span class="op">(</span><span class="va">ldm</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mean_clay</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">horizons_data</span><span class="op">$</span><span class="va">clay_r</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Mean clay content: %.1f%%\\n"</span>, <span class="va">mean_clay</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span><span class="va">url</span> <span class="op">&lt;-</span> <span class="fu">ldm_db_download_url</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Download from: %s\\n"</span>, <span class="va">url</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Download from: https://ncsslabdatamart.sc.egov.usda.gov/database_download.aspx\n</span>
<span class="r-in"><span><span class="va">cache_dir</span> <span class="op">&lt;-</span> <span class="fu">ldm_data_dir</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Data cached at: %s\\n"</span>, <span class="va">cache_dir</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data cached at: /home/runner/.local/share/R/labtaxa\n</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check what's cached</span></span></span>
<span class="r-in"><span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">cache_dir</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Cached files:\\n%s\\n"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">files</span>, collapse <span class="op">=</span> <span class="st">"\\n"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cached files:\n\n</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Andrew Brown.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

